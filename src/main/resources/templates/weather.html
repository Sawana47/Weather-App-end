<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>⛅Weather App by GoldenCat⛅</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Weather Icons CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">
    <link rel="stylesheet" type="text/css" href="/css/weather.css">
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h1 class="card-title">Weather in <span th:text="${city}">City</span>, <span th:text="${country}">Country</span></h1>
                    <span th:classappend="${weatherIcon} + ' weather-icon'"></span>
                    <p class="card-text"><strong>Description:</strong> <span th:text="${weatherDescription}">Description</span></p>
                    <p class="card-text"><strong>Temperature:</strong> <span th:text="${temperature}">Temperature</span>°C</p>
                    <p class="card-text"><strong>Humidity:</strong> <span th:text="${humidity}">Humidity</span>%</p>
                    <p class="card-text"><strong>Wind Speed:</strong> <span th:text="${windSpeed}">Wind Speed</span> m/s</p>
                    
                    <!-- Activity Selection -->
                    <div class="card-text mt-3">
                        <label for="activity">Select Activity:</label>
                        <select id="activity" class="form-control">
                            <option value="">-- Choose an activity --</option>
                            <option value="cycling">Cycling</option>
                            <option value="running">Running</option>
                            <option value="walking">Walking</option>
                            <option value="office">Office Commute</option>
                            <option value="trekking">Trekking / Hiking</option>
                            <option value="gym">Gym Workout</option>
                            <option value="outdoor sports">Outdoor Sports</option>
                            <option value="driving">Driving</option>
                            <option value="travelling">Travelling</option>
                            <option value="kids">Kids Outdoor Safety</option>
                            <option value="elderly">Elderly Safety</option>
                        </select>
                        <button class="btn btn-secondary btn-block mt-2" type="button" id="showActivitySuggestionBtn">
                            Show Activity Suggestion
                        </button>
                    </div>

                    <!-- Activity Suggestion Result -->
                     <p class="card-text mt-3 d-none" id="activity-suggestion-text">
                        <strong>Suggestion:</strong> <span></span>
                    </p>
                    
                    
                    <button class="btn btn-primary btn-block" type="button" id="showSuggestionBtn">
                        Show Clothing Suggestion
                    </button>
                    <p class="card-text mt-3 d-none" id="suggestionText">
    <strong>Suggestion:</strong> <span th:text="${weatherSuggestion}">Suggestion</span>
</p>
                    
                    <a href="/" class="btn btn-secondary btn-block">Back</a>
                    <div th:if="${error}" class="alert alert-danger mt-3">
                        <p>Error: <span th:text="${error}"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script th:inline="javascript">
    const city = /*[[${city}]]*/ 'Unknown';
</script>
<script>
    const toggleDisplay = (button, elementId, showText, hideText) => {
        const el = document.getElementById(elementId);
        el.classList.toggle('d-none');
        button.textContent = el.classList.contains('d-none') ? showText : hideText;
    };

    document.getElementById("showSuggestionBtn").addEventListener("click", function() {
        toggleDisplay(this, "suggestionText", "Show Clothing Suggestion", "Hide Clothing Suggestion");
    });

    document.getElementById("showActivitySuggestionBtn").addEventListener("click", function() {
        const activitySelect = document.getElementById("activity");
        const selectedActivity = activitySelect.value;

        if (!selectedActivity) {
            alert("Please select an activity first!");
            return;
        }

        const suggestionText = document.getElementById("activity-suggestion-text");
        const suggestionSpan = suggestionText.querySelector("span");

        if (!suggestionText.classList.contains('d-none')) {
            suggestionText.classList.add('d-none');
            this.textContent = "Show Activity Suggestion";
            return;
        }

        fetch(`/activity-suggestion?city=${encodeURIComponent(city)}&activity=${encodeURIComponent(selectedActivity)}`)
            .then(response => response.ok ? response.text() : Promise.reject('Network error'))
            .then(data => {
                suggestionSpan.textContent = data;
                suggestionText.classList.remove('d-none');
                this.textContent = "Hide Activity Suggestion";
            })
            .catch(error => {
                suggestionSpan.textContent = "Error fetching suggestion.";
                suggestionText.classList.remove('d-none');
            });
    });
</script>
</body>
</html>
